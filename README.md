# 效 3D 重建與姿態優化專案 README

本專案旨在實現一個從影像到高品質 3D 模型的自動化管線。其核心是結合 **GloMAP** 的高速運動恢復結構 (Structure from Motion, SfM) 能力與 **NeuS** 神經渲染模型的精細重建品質，並整合了先進的實驗追蹤與效能評測工具。

---

## 核心功能與增強部分
相較於基礎版本，我們引入了以下幾項關鍵增強，以提升效率、可比較性與最終重建品質 (PSNR)：

### 1. 雙重建管線與效能評測
為了能客觀評估 GloMAP 帶來的效率提升，我們建立了兩套平行且可比較的 SfM 管線：

- **glomap_wrapper.py (推薦)**: 採用 COLMAP 進行特徵提取與匹配，但使用速度更快的 GloMAP 進行核心的三維重建。  
- **colmap_wrapper.py**: 使用純 COLMAP 流程，作為效能比較的基準。  

✨ **新增功能**:
- **自動計時**: 兩套管線都內建了詳細的計時功能。當您透過 GUI (`surface.py`) 執行重建時，程式會自動在終端機和彈出視窗中報告總耗時，讓您可以直觀地比較兩者的速度差異。

---

### 2. Weights & Biases (WandB) 雲端實驗追蹤
為了更專業、更系統化地管理與分析實驗結果，我們在 `train.py` 中深度整合了 **Weights & Biases**。

✨ **新增功能**:
- **自動日誌**: 訓練過程中的所有關鍵指標 (Loss, PSNR, ATE 等) 都會自動上傳到您的 wandb 雲端儀表板。  
- **視覺化結果**:
  - **驗證影像**: 定期將渲染出的影像與真實影像拼接後上傳，讓您能直觀地看到模型進步的過程。  
  - **3D 模型**: 定期將重建出的 `.ply` 網格模型上傳，您可以在網頁上直接進行 3D 互動預覽。  
- **實驗比較**: wandb 強大的儀表板讓您可以輕鬆比較不同設定（例如，使用 GloMAP vs. COLMAP，或使用不同超參數）下的訓練曲線與最終成果。  

---

### 3. 高 PSNR 增強策略
這是讓 GloMAP 流程最終品質超越 COLMAP 的最關鍵強化。我們透過修改神經網路架構和訓練策略，使其能夠在 GloMAP 提供的良好幾何基礎上，學習到前所未有的細節。

✨ **新增功能**:
- **增強版設定檔 (`confs/dtu_sift_porf_enhanced.conf`)**:
  - 增加模型容量: 加深並加寬了 SDF 和渲染網路，使其能學習更複雜的細節。  
  - 增加光線採樣數: 大幅提升了渲染時沿光線的採樣點數量，直接提升渲染精度。  
  - 延長訓練時間: 給予模型更充分的時間來收斂到一個高品質的解。  

- **由粗到精的位置編碼 (Coarse-to-Fine Positional Encoding)**:  
  - **原理**: 訓練初期，模型只學習場景的低頻輪廓（像一張模糊的草圖），建立穩定的幾何基礎。隨著訓練進行 (`anneal_end` 參數控制)，逐漸解鎖高頻細節，讓模型在穩定的基礎上進行精雕細琢。  
  - **效果**: 雖然 PSNR 在訓練初期成長較慢，但在中期會出現拐點並加速攀升，最終達到遠高於傳統訓練方法的峰值，從而讓 GloMAP 流程在速度和品質上實現雙重超越。  


## 如何執行

### 1. 啟動應用程式

整個流程可以透過一個簡單的圖形化介面 (GUI) 啟動。

```bash
python surface.py
```

### 2. 監控訓練過程

您可以使用兩種工具來視覺化和監控訓練的進度：

#### TensorBoard (本地監控)

用於查看損失函數曲線、PSNR 等指標。

```bash
tensorboard --logdir exp_dtu\scan24\dtu_sift_porf\pose_logs
```
*請將 `exp_dtu\scan24\dtu_sift_porf` 替換為您實際的實驗輸出路徑。*

#### Weights & Biases (雲端儀表板)

提供更強大的實驗追蹤、比較與視覺化功能。您可以在訓練開始後，從終端機的輸出中找到對應的 `wandb` 專案連結，並在瀏覽器中打開。

-   **優點**:
    -   雲端儲存，隨時隨地存取。
    -   可輕鬆比較不同實驗的結果。
    -   除了指標曲線，還可以視覺化 3D 點雲、渲染影像等。
